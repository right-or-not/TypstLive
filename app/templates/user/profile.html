<!-- <h1>templates/user/profile.html</h1> -->

{% extends "user/base_user.html" %}

{% block title %}Edit Profile{% endblock %}

{% block user_content %}
<h2 class="page-title">Edit Profile</h2>

<form action="{{ url_for('main.profile') }}" method="POST" enctype="multipart/form-data">

    <div class="avatar-section">
        <img id="avatar-preview" src="{{ current_user.get_avatar_url() }}?t={{ current_user.updated_at.timestamp() if current_user.updated_at else 0 }}" alt="Avatar Preview" class="user-avatar-lg">
        
        <label for="avatar-upload" class="avatar-upload-label">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
            Change Avatar
        </label>
        <input type="file" name="avatar" id="avatar-upload" accept="image/*">
    </div>

    <div class="form-group">
        <label>Username</label>
        <input type="text" class="form-control" value="{{ current_user.username }}" disabled style="background-color: #f5f5f5; cursor: not-allowed;">
    </div>

    <div class="form-group">
        <label>Email</label>
        <input type="email" class="form-control" value="{{ current_user.email }}" disabled style="background-color: #f5f5f5; cursor: not-allowed;">
    </div>

    <div class="form-group">
        <label for="gender">Gender</label>
        <select name="gender" id="gender" class="form-control">
            <option value="Secret" {% if current_user.gender == 'Secret' %}selected{% endif %}>Secret</option>
            <option value="Male" {% if current_user.gender == 'Male' %}selected{% endif %}>Male</option>
            <option value="Female" {% if current_user.gender == 'Female' %}selected{% endif %}>Female</option>
        </select>
    </div>

    <div class="form-group">
        <label for="phone">Phone Number</label>
        <input type="text" name="phone_number" id="phone" class="form-control" value="{{ current_user.phone_number or '' }}" placeholder="Enter phone number">
    </div>

    <div class="form-group">
        <label for="birthday">Birthday</label>
        <input type="date" name="birthday" id="birthday" class="form-control" value="{{ current_user.birthday }}">
    </div>

    <div class="form-group">
        <label for="signature">Signature</label>
        <input type="text" name="signature" id="signature" class="form-control" value="{{ current_user.signature or '' }}" placeholder="A short signature">
    </div>

    <div class="form-group">
        <label for="bio">Bio</label>
        <textarea name="bio" id="bio" class="form-control" placeholder="Tell us about yourself...">{{ current_user.bio or '' }}</textarea>
    </div>

    <button type="submit" class="btn-save">Save Changes</button>
</form>

<script>
    document.getElementById('avatar-upload').addEventListener('change', function(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('avatar-preview').src = e.target.result;
            }
            reader.readAsDataURL(file);
        }
    });
</script>

{% endblock %}